---
# dd-dt-run-image.yaml, rendered from dd-dt-run-image.yaml.j2
#
# dd-dt-run-image script configuration file
#
# author  : stefan schablowski
# contact : stefan.schablowski@desmodyne.com
# created : 2020-02-15


# TODO: add info which attributes are mandatory and which are optional
# TODO: clarify variables being defined or not / null / value / etc.


# container namespace used locally when building image
local_namespace:   {{ local_namespace }}


# name of container when run off image
cont_name:         {{ cont_name }}

# network ports exposed by container on host network interface
# NOTE: for some reason, jinja2 outputs None if value is null;
# recommended workaround: https://stackoverflow.com/a/26536945
cont_ports:        {{ cont_ports or 'null' }}

# name of the container image
image_name:        {{ image_name }}

# docker container image tag naming pattern: <stage>-<hash|semver>
# first part of the tag name: stage, i.e. feature, develop, release, master
# second part of the tag name:
#   feature and develop branches : hash SHA1 sum of the most recent commit
#   release and master branches  : semantic version / repo tag, e.g. 0.5.0
# both commit and semver will have a -DIRTY suffix if building from unclean
image_tag:         {{ image_tag }}

# network name; must match nginx / nginx-le network name;
# see InfoSec/Lets Encrypt/code/docker/cc-nginx-proxy/docker-compose.yml
network_name:      {% if network_name is defined %}{{ network_name }}{% else %}null{% endif %}

# container volumes; must match paths set in base and in this container
# https://docs.docker.com/v17.12/edge/engine/reference/commandline/ ...
#  ... run/#add-bind-mounts-or-volumes-using-the-mount-flag
# https://docs.docker.com/v17.12/edge/engine/reference/commandline/ ...
#  ... service_create/#add-bind-mounts-volumes-or-memory-filesystems
# https://docs.docker.com/storage/volumes
# NOTE: mounts / volumes are not created explicitly up front, but by passing
# corresponding arguments to docker run; adding this doc for completeness:
# https://docs.docker.com/v17.12/engine/reference/commandline/volume_create
# NOTE: must match VOLUME path hardcoded in base Dockerfile:
# https://github.com/docker-library/postgres/blob/master/11/Dockerfile
# Jinja templates: https://jinja.palletsprojects.com/en/2.11.x/templates
# NOTE: can't use literal jinja statements in comments, cause render error
# https://jinja.palletsprojects.com/en/2.11.x/templates/#defined
volumes:           {% if volumes is defined %}
{%- for volume in volumes %}
  - source: {{ volume.source }}
    target: {{ volume.target }}
{%- endfor %}{% else %}null{% endif %}
