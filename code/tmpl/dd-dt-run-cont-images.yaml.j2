---
# dev.yaml
#
# CI/CD script configuration file
#
# author  : stefan schablowski
# contact : stefan.schablowski@desmodyne.com
# created : 2018-10-07


# container namespace used locally when building image
local_namespace:       desmodyne

# follow container logs since timestamp, see docker logs --help > --since
log_since:             1h


# list of data sets to configure container images
images:

  # name of the container image
  ci-mailflow-database_dev:

    # name of container when run off image
    cont_name:        ct-mailflow-database

    # network ports exposed by container on host network interface
    cont_ports:       '5432:5432'

    # docker container image tag naming pattern: <stage>-<hash|semver>
    # first part of the tag name: stage, i.e. feature, develop, release, master
    # second part of the tag name:
    #   feature and develop branches : hash SHA1 sum of the most recent commit
    #   release and master branches  : semantic version / repo tag, e.g. 0.5.0
    # build CI/CD script determines stage and replaces '<image_tag>' by value;
    # both commit and semver will have a -DIRTY suffix if building from unclean
    image_tag:        <image_tag>

    # network name; must match nginx / nginx-le network name;
    # see InfoSec/Lets Encrypt/code/docker/cc-nginx-proxy/docker-compose.yml
    # NOTE: not used for local dev
    # network_name: net-nginx-proxy

    # container volumes; must match paths set in base and in this container
    # https://docs.docker.com/v17.12/edge/engine/reference/commandline/ ...
    #  ... run/#add-bind-mounts-or-volumes-using-the-mount-flag
    # https://docs.docker.com/v17.12/edge/engine/reference/commandline/ ...
    #  ... service_create/#add-bind-mounts-volumes-or-memory-filesystems
    # https://docs.docker.com/storage/volumes
    # NOTE: mounts / volumes are not created explicitly up front, but by passing
    # corresponding arguments to docker run; adding this doc for completeness:
    # https://docs.docker.com/v17.12/engine/reference/commandline/volume_create
    # NOTE: must match VOLUME path hardcoded in base Dockerfile:
    # https://github.com/docker-library/postgres/blob/master/11/Dockerfile
    # TODO: source name convention might not scale for volumes shared by containers
    volumes:
      - source: ci-mailflow-database-data
        target: /var/lib/postgresql/data
